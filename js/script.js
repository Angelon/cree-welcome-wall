/* Author:

*/

var articleSources = [{"title":"Take a video tour of Cree’s LED Components and Modules Booth at Lightfair 2012","url_title":"take-a-video-tour-of-crees-led-components-and-modules-booth-at-lightfair-20","entry_id":"3","channel_id":"1","author_id":"1","status":"open","entry_date":"1336715216000","edit_date":"1348270917000","expiration_date":"","feedbody":"<p>We&#8217;ve got a lot of products and information about our services packed into our LED Components and Modules booth this year. Cree Product Marketing Manager Paul Scheidt shows you a few of this year&#8217;s highlights, including:<\/p>\n<ul>\n<li><a href=\"http:\/\/www.cree.com\/led-components-and-modules\/products\/modules\/non-integrated\/lmh2\">LMH2 Modules<\/a><\/li>\n<li><a href=\"http:\/\/www.cree.com\/led-components-and-modules\/products\/xlamp\/arrays-directional\/xlamp-mtg2\">XLamp MT-G2 LED<\/a><\/li>\n<li><a href=\"http:\/\/www.cree.com\/led-components-and-modules\/tools-and-support\/cree-services\">Cree Services and TEMPO testing<\/a><\/li>\n<li><a href=\"http:\/\/www.cree.com\/led-components-and-modules\/products\/xlamp\/reference-designs\">Cree Reference Designs<\/a><\/li>\n<\/ul>\n<p><iframe width=\"560\" height=\"315\" src=\"http:\/\/www.youtube.com\/embed\/il1LPVEgfAs\" frameborder=\"0\" allowfullscreen><\/iframe><\/p>\n<img src=\"http:\/\/feeds.feedburner.com\/~r\/CreeLEDRevolutionBlog\/~4\/KNoAGA4GthE\" height=\"1\" width=\"1\"\/>"},{"title":"Here’s what Cree lighting is showcasing at Lightfair 2012","url_title":"heres-what-cree-lighting-is-showcasing-at-lightfair-2012","entry_id":"6","channel_id":"1","author_id":"1","status":"open","entry_date":"1336531316000","edit_date":"1348270917000","expiration_date":"","feedbody":"<p>For the first time, Cree’s lighting booth at Lightfair will feature both indoor <em>and<\/em> outdoor lighting, and you won’t want to miss either.<\/p>\n<p>For many of you, Lightfair offers the first chance to see the outdoor lighting products Cree launched since acquiring Ruud Lighting last year. And boy has it been a busy year.<\/p>\n<p>Some of the outdoor LED lighting products we’ll be showcasing at our booth #3008  include:<\/p>\n<ul>\n<li><strong>Cree XSP Series Street Light:<\/strong> Our most affordable and efficient LED street light, <a href=\"http:\/\/www.cree.com\/XSP\">the XSP Series<\/a> is designed to speed payback to municipalities. It’s the high-pressure sodium street light buster, using nearly 50 percent less energy than that wasteful, traditional street light; and it’s designed to last three times longer too.  Come see why this LED street light is the ideal choice for cities and municipalities looking to save money and resources.<\/li>\n<\/ul>\n<ul>\n<li><strong>Aeroblades: <\/strong>If you want to see where industry-leading LED innovation and high design meet, stop by our booth and head straight for our <a title=\"Cree Aeroblades \" href=\"http:\/\/www.cree.com\/lighting\/products\/outdoor\/area\/aeroblades\">Aeroblades<\/a> display. Designed and engineered with Speirs + Major, one of the world’s leading lighting design firms, the Aeroblades luminaire series takes a bold approach to architectural street, area and security lighting. You’ll know why as soon as you see it.<\/li>\n<\/ul>\n<ul>\n<li><strong>Cree Traditional Post-Top LED Upgrade Kit:<\/strong> If you’re coming to Lightfair looking for a way to lower operating costs for outdoor lighting, be sure to check out our new <a title=\"Cree LED Upgrade Kit\" href=\"http:\/\/www.cree.com\/lighting\/products\/outdoor\/streetlights\/traditional-post-top-led-upgrade-kit\">LED Upgrade Kit<\/a>. Our Upgrade Kit seamlessly transforms existing, inefficient luminaires into energy-efficient lighting, low-maintenance LED luminaires.<\/li>\n<\/ul>\n<p><center><div id=\"attachment_1579\" class=\"wp-caption aligncenter\" style=\"width: 545px\"><img class=\"size-large wp-image-1579 \" src=\"http:\/\/www.creeledrevolution.com\/blog\/wp-content\/uploads\/2012\/05\/IMG_2219-764x1024.jpg\" alt=\"The Cree lighting booth was still under construction Tuesday afternoon.\" width=\"535\" height=\"717\" \/><p class=\"wp-caption-text\">The Cree lighting booth was still under construction Tuesday afternoon.<\/p><\/div><\/center><\/p>\n<p>We’ll also be featuring a variety of our indoor LED lighting products at Lightfair including:<\/p>\n<ul>\n<li><strong>Cree CS Series LED Linear Luminaire:<\/strong> Our new high-efficacy suspended linear luminaire offers fast payback to low bay lighting applications. Using 40 to 50 percent less energy than comparable linear fluorescents, the <a title=\"Cree CS18\" href=\"http:\/\/www.cree.com\/lighting\/products\/indoor\/industrial\/cs18\">CS Series LED Linear Luminaire<\/a> delivers an unmatched performance combination of up to 120 lumens per watt, 90 CRI and 75,000 hour lifetime. This is unlike any other linear fluorescent or LED lighting solution on the market!<\/li>\n<\/ul>\n<ul>\n<li><strong>Cree CR Series LED Troffer:<\/strong> Our CR Series made its debut at last year’s Lightfair in Philadelphia. This year it’s bigger, better, faster and even more affordable. The new <a title=\"Cree CR Troffer\" href=\"http:\/\/crseries.creeledlighting.com\/\">CR Troffer<\/a> addresses more applications and eliminates the use of antiquated fluorescent technology in new or retrofit commercial and industrial settings. We also recently announced new pricing to drive even faster payback for building contractors, designers and owners.<\/li>\n<\/ul>\n<ul>\n<li><strong>Cree SR Series Architectural Downlight: <\/strong> Just this month we announced an extension in our family of the world’s most efficient downlights, with our revolutionary <a title=\"Cree SR Series\" href=\"http:\/\/www.cree.com\/lighting\/products\/indoor\/architectural\/sr6-downlight\">SR Series LED Architectural Downlight<\/a>. This six-inch LED architectural luminaire features modern design, high color quality and double the efficacy of fluorescent technology. It uses 85 percent less energy and is designed to last up to 30 times longer than comparable incandescent lighting! The Cree lighting booth isn’t the only place in Vegas to see this downlight in action. Stop by our booth and ask about our installation at Caesars Palace!<\/li>\n<\/ul>\n<ul>\n<li><strong>Cree KR Series LED Downlight:<\/strong> After you see our new <a title=\"Cree KR Series\" href=\"http:\/\/www.cree.com\/lighting\/products\/indoor\/downlights-us\/kr-series\">KR Series<\/a>, you may be hard-pressed to come up with a reason to specify a CFL downlight again. This is the industry’s first LED downlight designed to deliver specification-grade lighting performance with pricing to match the everyday price of incumbent technology fluorescent grade downlights. With initial models designed to replace 18 and 26 watt fluorescent downlights, the KR Series is at least 35 percent more efficient than incumbent fluorescents and is designed to last up to five times longer.<\/li>\n<\/ul>\n<p>Of course, that’s not all. We’ve got even more outdoor and indoor LED lighting options illuminating our Lightfair booth this year! Come by and see them all, or make plans to get a personal booth tour during our LED Lighting Tweetup at 2:30 p.m. Thursday, May 10 at Booth #3008.<\/p>\n<img src=\"http:\/\/feeds.feedburner.com\/~r\/CreeLEDRevolutionBlog\/~4\/qn55dUSiCL4\" height=\"1\" width=\"1\"\/>"},{"title":"Earth Day 2012: Am I Doing Everything I Can To Save Energy?","url_title":"earth-day-2012-am-i-doing-everything-i-can-to-save-energy","entry_id":"8","channel_id":"1","author_id":"1","status":"open","entry_date":"1334954996000","edit_date":"1348270917000","expiration_date":"","feedbody":"<p><strong>Today’s guest blog post is by Timothy Henning, Cree’s ENERGY STAR program manager.<\/strong><\/p>\n<p>Earth Day offers us all a reminder to ask ourselves: Am I doing all I can to save energy? Is there more I could be doing? Chances are there are a few easy steps you could take right now to conserve more energy in your day-to-day life.<\/p>\n<p>Not sure what? The U.S. Environmental Protection Agency (EPA) offers a number of programs that make it easier to save money and reduce greenhouse gas emissions.  One of those programs is ENERGY STARs Across America.<\/p>\n<p>Finding out what habits you can change or even what habits your neighbors are changing is as easy as clicking a button. The EPA website contains an interactive “ENERGY STARs Across America” map that highlights energy-saving educational events being held across America that you can participate in. This interactive <a href=\"https:\/\/www.energystar.gov\/index.cfm?fuseaction=globalwarming.showMap\">map<\/a> also helps you visualize how many people and organizations around the world are participating in the movement.<\/p>\n<p><center><img class=\"aligncenter size-medium wp-image-1549\" title=\"ENERGY STAR map\" src=\"http:\/\/www.creeledrevolution.com\/blog\/wp-content\/uploads\/2012\/04\/ENERGY-STAR-map-300x211.png\" alt=\"ENERGY STAR map\" width=\"300\" height=\"211\" \/><\/center><\/p>\n<p>If you’re not interested in attending an event, you can still make a change in the comfort of your own home by taking the ENERGY STAR Pledge. When you pledge, you are making a commitment to save energy and money, and to help protect the environment by taking energy-saving actions in your home, such as:<\/p>\n<ul>\n<li> Changing a light to an ENERGY STAR-qualified LED model. Cree has qualified over 48 unique SKUs through the ENERGY STAR program to date!  You can visit our <a href=\"http:\/\/www.cree.com\/lighting\/products\">website<\/a> to see the wide variety of lighting products that Cree offers.  Additionally, you can go to your nearest Home Depot and check out the ENERGY STAR-qualified EcoSmart 4” and 6” recessed LED downlights.<\/li>\n<li>Enabling your computer to power down when not in use.<\/li>\n<li> Installing and using a programmable thermostat correctly with pre-programmed settings.<\/li>\n<li> Choosing products that have earned the ENERGY STAR rating, and more.<\/li>\n<\/ul>\n<p>To date, more than 2.8 million people nationwide have pledged to take small, energy-saving steps that can change the world. If every American household took part in the pledge, we would save $24 billion in annual energy costs and prevent greenhouse gases equivalent to the emissions from 27 million cars.<\/p>\n<p>Take the ENERGY STAR Pledge now, and join with millions of Americans who are taking small steps that make a big difference in helping to prevent climate change. Thank you for your support!<\/p>\n<img src=\"http:\/\/feeds.feedburner.com\/~r\/CreeLEDRevolutionBlog\/~4\/tiOAPe5B_PM\" height=\"1\" width=\"1\"\/>"}]
//var thumbnailSources = articleSources.replace(/<iframe[a-zA-Z0-9\s\=\\\"\:\/\.]*><\\\/iframe>/g, "");
var bindContext = function (fn, context, arguments) {
	if(arguments){
		//console.log("Binder Log");
		//console.log(arguments);
		//console.log(context);
		//console.log(fn);
	}
	return function () {
		fn.apply(context, arguments);
	};
};

var preProcessThumbContent = function (content){
	//console.log("Removing Stuff");
	//console.log(content);
	//console.log(content.(/<iframe[a-zA-Z0-9\s\=\\\"\:\/\.><]*iframe>/));
	//var myContent = content.replace(/<iframe[a-zA-Z0-9\s\=\\\"\:\/\.><]*iframe>/g, "");
	return content;
}

function jsonFlickrApi(data){
	//console.log("jsonFlickrApi Thing");
	
	if(data.stat === "ok"){
		WelcomeWall.flickrEventsHandler.broker.trigger("Flickr_API_CALL_COMPLETE", data);
	}
	else {
		console.log("There was an error from flickr!");
		console.log(data);
	}

}

var WelcomeWall = {
	Tile : function(tileNumber, empty){
		this.tileNumber = tileNumber;
		this.element = $("<tile />");
		this.element.attr("tile", tileNumber);
		this.container = $("<tilecontainer />").attr("tile", tileNumber).append(this.element);
		this.frontFace = $("<face />").addClass("front").appendTo(this.element);
		this.backFace = $("<face />").addClass("back").appendTo(this.element);

		this.init = function (sourceNumber){
			this.sourceNumber = sourceNumber;
			var tileInfo = articleSources[sourceNumber];
			//console.log("Tile Init");
			this.container.click(bindContext(this.clickHandler, this));
			if(tileInfo){
				//console.log(tileInfo.title);
				var thumbnailTitle = $("<h3 />").html(tileInfo.title);
				thumbnailTitle.appendTo(this.frontFace);
				var tilefacecontent = $("<div />").addClass("tilefacecontent");
				tilefacecontent.appendTo(this.backFace);
				var expandedTitle = $("<h3 />").html(tileInfo.title);
				expandedTitle.appendTo(tilefacecontent);
				var expandedContent = $("<div />").addClass("expandedcontent");
				expandedContent.html(preProcessThumbContent(tileInfo.feedbody));
				expandedContent.appendTo(tilefacecontent);
				var image = $("<div />").addClass("image-container");
				expandedContent.prepend(image);
			}
			else {

			}
		}
	},
	TileGroup : function(){
		this.element = $("<tilegroup />");
		this.container = $("<tilegroupcontainer />").append(this.element);
		this.currentTile;
		this.tiles = {};

		this.init = function (numberOfTiles){
			var that = this;
			this.groupEvents = _.extend({}, Backbone.Events);
			this.groupEvents.on("TILE_CLICKED", function(e){
				console.log("A tile was clicked");
				//console.log(e);
				that.flipTile(e);
			});
			this.groupEvents.on("TILE_FLIP_COMPLETE", function (e){
				that.activateArticleNavButtons();
				that.activateNavButtons();
			})
			this.groupEvents.on("TILE_RESET", function(e){
				console.log("A tile was reset");
				//console.log(e);
				that.sendTileToBack(e);
			});
			for(var x=1; x<=numberOfTiles;x++){
				var tile = new WelcomeWall.Tile(x);
				tile.broker = this.groupEvents;
				this.tiles[x] = tile;
				this.element.append(tile.container);
				tile.init(x-1);
			}
			this.tileReadMoreButton = $("<div />").attr({"class":"article-button readmore"});
			this.tileCloseButton = $("<div />").attr({"class":"article-button close"});
			this.element.append(this.tileReadMoreButton);
			this.element.append(this.tileCloseButton);

			this.nextButton = $("<div />").attr({"class":"tile-nav-button next"});
			this.previousButton = $("<div />").attr({"class":"tile-nav-button previous"});
			this.element.append(this.nextButton);
			this.element.append(this.previousButton);
		}

	},
	Article : function (articleNumber){
		this.element = $("<articlecontainer />");
		this.container = this.element;

		this.tileGroup = new WelcomeWall.TileGroup();
		this.frontFace = $("<articleface />").addClass("front");
		this.backFace = $("<articleface />").addClass("back");
		this.fullArticle = new WelcomeWall.FullArticle();
		this.articleIframe = $("<iframe />").attr({
			src: "",
			height:"90%",
			width:"100%",
			frameborder:"0"
		});
		this.backFace.append(this.articleIframe).appendTo(this.element);
		this.frontFace.append(this.tileGroup.container).appendTo(this.element);
		this.container.append(this.fullArticle.container);


		this.init = function (){
			var that = this;
			this.tileGroup.init(4);
			this.fullArticle.init();
			this.evBroker = _.extend({}, Backbone.Events);
			this.evBroker.on("MORE_BUTTON_CLICKED", function(e){
				console.log("More Event")
				console.log(e);
				//var sourceNumber = 
				that.fullArticle.showFullArticle((parseInt(e)-1));
			});
			this.tileGroup.broker = this.evBroker;
		}
	},
	ArticlePanel : function(panelNumber){
		this.container = $("<div />").attr({
			role:"panel-"+panelNumber
		});
		this.article;
		this.init = function (){
			console.log("Aritcle Panel Init");
			for(var x=1; x<=2;x++){
				var article = new WelcomeWall.Article(x);
				this.article = article;
				this.container.append(article.container);
				article.init();
			}
		}
	},
	FullArticle : function (){
		this.container = $("<div />").addClass("faux-article-container");
		this.frontFaceTop = $("<div />").addClass("faux-article-face-top");
		this.frontFaceFrontFace = $("<div />").addClass("front");
		this.frontFaceBackFace = $("<div />").addClass("back");
		this.frontFaceBottom = $("<div />").addClass("faux-article-face-bottom");
		this.container.append(this.frontFaceBottom);
		this.container.append(this.frontFaceTop);
		this.scrollButtonTop = $("<div />").addClass("scroll-button").addClass("scroll-button-top");
		this.scrollButtonBottom = $("<div />").addClass("scroll-button").addClass("scroll-button-bottom");
		this.articleCloseButton = $("<div />").addClass("scroll-button").addClass("close-button").html("Close");
		this.container.append(this.scrollButtonTop);
		this.container.append(this.scrollButtonBottom);
		this.container.append(this.articleCloseButton);
		
		this.tileGroup1 = new WelcomeWall.TileGroup();
		this.tileGroup2 = new WelcomeWall.TileGroup();
		this.canvasId = 0;

		this.init = function (){
			this.tileGroup1.init(2);
			this.tileGroup2.init(2);
			
			//this.frontFaceBottom.append(this.tileGroup2.container);
			this.frontFaceTop.append(this.frontFaceBackFace);
			this.frontFaceTop.append(this.frontFaceFrontFace);
			
			this.frontFaceFrontFace.append(this.tileGroup1.container);

		}
	},
	FlickrEventsHandler : function (){
		this.broker;
		this.currentImage;
		this.imageOverlay;
		this.imagesList;

		this.init = function(welcome){
			this.broker = _.extend({}, Backbone.Events);
			if(welcome){
				this.imageOverlay = $("<div />").addClass("flickr-image-overlay");
				this.imageContainer = $("<div />").addClass("flickr-image-container");
				this.imagePreloader = $("<div />").addClass("flickr-image-preloader");
				//$(".flickr-panel .flickr-image").append(this.imagePreloader);
				$(".flickr-panel .flickr-image").append(this.imageContainer);
				$(".flickr-panel .flickr-image").append(this.imageOverlay);
				this.currentImage = 0;
				this.previousImageButton = $("<div />").addClass("flickr-image-button").addClass("flickr-previous-image-button");
				this.nextImageButton = $("<div />").addClass("flickr-image-button").addClass("flickr-next-image-button");
				$(".flickr-panel .flickr-image").append(this.previousImageButton);
				$(".flickr-panel .flickr-image").append(this.nextImageButton);
				this.captionPanel = $("<div />").addClass("flickr-caption-panel");
				$(".flickr-panel .flickr-image").append(this.captionPanel);
			}
			else {
				WelcomeWall.flickrEventsHandler.getUserPublicPhotos();
			}
			
		}
	},
	
	
	init: function(welcome, panels){
		if(panels){
			this.panel2 = new this.ArticlePanel(2);
			$(this.panel2.container).insertAfter("header");
			this.panel2.init();
			this.flickrEventsHandler = new WelcomeWall.FlickrEventsHandler();
			this.flickrEventsHandler.init();
		}
		if(welcome){
			this.flickrEventsHandler = new WelcomeWall.FlickrEventsHandler();
			this.flickrEventsHandler.init(true);
		}
	}

}

WelcomeWall.FlickrEventsHandler.prototype.attachEventHandler = function (event, handler){
	var that = this;
	this.broker.on(event, function(data){
		//console.log("Attaching Event Handler")
		//console.log(this);
		handler.apply(that, [data]);
	});
}

WelcomeWall.FlickrEventsHandler.prototype.activateNavButtons = function (){
	var that = this;
	if(this.currentImage > 0){
		this.previousImageButton.fadeIn();
		this.previousImageButton.click(function (){
			that.getPreviousPhoto();
		});
		that.attachEventHandler("NO_SIZE_FOUND", that.getPreviousPhoto);
	}

	if(this.currentImage < this.imagesList.length-1){
		this.nextImageButton.fadeIn();
		this.nextImageButton.click(function (){
			that.getNextPhoto();
		});
		that.attachEventHandler("NO_SIZE_FOUND", that.getNextPhoto);
	}
	
	
	
}

WelcomeWall.FlickrEventsHandler.prototype.deactivateNavButtons = function (){
	var that = this;
	this.previousImageButton.fadeOut()
	this.nextImageButton.fadeOut();
	this.nextImageButton.unbind();
	this.previousImageButton.unbind();
	this.deactivateCaptionPanel();
}

WelcomeWall.FlickrEventsHandler.prototype.removeEventHandler = function (event){
	this.broker.off(event);
}

WelcomeWall.FlickrEventsHandler.prototype.getGroupPhotos = function (group_id){
	var groupId = group_id || "554802@N25";
	this.attachEventHandler("Flickr_API_CALL_COMPLETE", this.getGroupPhotosHandler);
	$.getJSON("http://api.flickr.com/services/rest/?method=flickr.groups.pools.getPhotos&group_id=" + groupId + "&api_key=3bdd28c7cb805fc97e345cfc6f4bf0b3&format=json&=?");
}

WelcomeWall.FlickrEventsHandler.prototype.getUserPublicPhotos = function (user_id){
	var userId = user_id || "87646671@N07";
	this.attachEventHandler("Flickr_API_CALL_COMPLETE", this.getPublicPhotosHandler);
	$.getJSON("http://api.flickr.com/services/rest/?method=flickr.people.getPublicPhotos&user_id=" + userId + "&api_key=3bdd28c7cb805fc97e345cfc6f4bf0b3&format=json&=?");
}

WelcomeWall.FlickrEventsHandler.prototype.getPhotoSizes = function (photo_id, callback){
	var photoId = photo_id || "8043778857";
	this.attachEventHandler("Flickr_API_CALL_COMPLETE", callback || this.getPhotoSizesHandler);
	$.getJSON("http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&photo_id=" + photoId + "&api_key=3bdd28c7cb805fc97e345cfc6f4bf0b3&format=json&=?");
	
}

WelcomeWall.FlickrEventsHandler.prototype.getPhotoInfo = function (photo_id, callback){
	var photoId = photo_id || "8043778857";
	this.attachEventHandler("Flickr_API_CALL_COMPLETE", callback || this.getPhotoInfoHandler);
	$.getJSON("http://api.flickr.com/services/rest/?method=flickr.photos.getInfo&photo_id=" + photoId + "&api_key=3bdd28c7cb805fc97e345cfc6f4bf0b3&format=json&=?");
	//this.deactivateNavButtons();
}

WelcomeWall.FlickrEventsHandler.prototype.getPublicPhotosHandler = function (data){
	console.log("getPublicPhotosHandler");
	console.log(data);
	this.imagesList = data.photos.photo;
	this.removeEventHandler("Flickr_API_CALL_COMPLETE");
	this.getPhotoSizes(data.photos.photo[this.currentImage].id);
	//this.preLoadImages();
}

WelcomeWall.FlickrEventsHandler.prototype.getGroupPhotosHandler = function (data){
	console.log("getGroupPhotosHandler");
	console.log(data);
	this.imagesList = data.photos.photo;
	this.removeEventHandler("Flickr_API_CALL_COMPLETE");
	//this.currentImage = 1;
	this.getPhotoSizes(data.photos.photo[this.currentImage].id);
	//this.preLoadImages();
}

WelcomeWall.FlickrEventsHandler.prototype.getPhotoSizesHandler = function (data){
	console.log("getPhotoSizesHandler");
	console.log(data);
	this.removeEventHandler("Flickr_API_CALL_COMPLETE");
	var bestSize = this.getBestPhotoSize(data.sizes.size);
	var that = this;
	//console.log(data.sizes.size[data.sizes.size.length-1]);
	if(bestSize){
		console.log("Size Found");
		console.log(bestSize.source);
		var newImage = $("<img />").attr({
			src : bestSize.source
		}).one('load', function() { //Set something to run when it finishes loading
          
          that.imageOverlay.fadeIn(function (){
			that.imageContainer.html("");
			that.imageContainer.append(newImage2);
			that.imageOverlay.hide();
			that.activateNavButtons();
			that.getPhotoInfo(that.imagesList[that.currentImage].id);
		});
        })
        .each(function() {
          //Cache fix for browsers that don't trigger .load()
          if(this.complete) $(this).trigger('load');
        });;

		var newImage2 = $("<img />").attr({
			src : bestSize.source
		});
		this.imageOverlay.html("");
		this.imageOverlay.append(newImage);
		
		this.removeEventHandler("NO_SIZE_FOUND");
		
	}
	else {
		console.log("No Sizes Found");
		this.broker.trigger("NO_SIZE_FOUND");
	}
	
}

WelcomeWall.FlickrEventsHandler.prototype.getPhotoInfoHandler = function (data) {
	console.log("getPhotoInfoHandler");
	console.log(data);
	this.removeEventHandler("Flickr_API_CALL_COMPLETE");
	this.captionPanel.html(data.photo.description._content);
	this.activateCaptionPanel();
}

WelcomeWall.FlickrEventsHandler.prototype.activateCaptionPanel = function(){
	this.captionPanel.fadeIn();
}

WelcomeWall.FlickrEventsHandler.prototype.deactivateCaptionPanel = function(){
	this.captionPanel.fadeOut();
}

WelcomeWall.FlickrEventsHandler.prototype.getBestPhotoSize = function(sizes){
	//console.log("Finding best size");
	//console.log(sizes.length-1);
	var image;
	for(var x in sizes){
		var size = parseInt(sizes[x].height);
		//console.log(sizes[x]);
		if(size >= 500 && size < 800){
			//console.log(x);
			image = sizes[x];
			//if(x == sizes.length-1){
				//return sizes[x];
			//}
		}
	}

	return image;
}

WelcomeWall.FlickrEventsHandler.prototype.getBestPhotoSizeForArticle = function(sizes){
	//console.log("Finding best size");
	//console.log(sizes.length-1);
	var image;
	for(var x in sizes){
		var size = parseInt(sizes[x].height);
		//console.log(sizes[x]);
		if(size >= 300 && size <= 500){
			//console.log(x);
			image = sizes[x];
			//if(x == sizes.length-1){
				//return sizes[x];
			//}
		}
	}

	return image;
}

WelcomeWall.FlickrEventsHandler.prototype.preLoadImages = function (){
	for(var x in this.imagesList){
		this.getPhotoSizes(this.imagesList[x].id, this.preLoadImagesEventHandler);
	}
}

WelcomeWall.FlickrEventsHandler.prototype.preLoadImagesEventHandler = function(data){
	console.log("preLoadImagesEventHandler");
	console.log(data);
	this.removeEventHandler("Flickr_API_CALL_COMPLETE");
	var bestSize = this.getBestPhotoSize(data.sizes.size);
	var that = this;
	//console.log(data.sizes.size[data.sizes.size.length-1]);
	if(bestSize){
		console.log("Size Found");
		var newImage = $("<img />").attr({
			src : bestSize.source
		});
		this.imagePreloader.append(newImage);
		this.removeEventHandler("NO_SIZE_FOUND");
	}
	else {
		console.log("No Sizes Found");
		//this.broker.trigger("NO_SIZE_FOUND");
	}
}

WelcomeWall.FlickrEventsHandler.prototype.getNextPhoto = function(){
	console.log("Getting Next Image");
	this.currentImage++;
	this.getPhotoSizes(this.imagesList[this.currentImage].id);
	this.deactivateNavButtons();
}

WelcomeWall.FlickrEventsHandler.prototype.getPreviousPhoto = function(){
	this.currentImage--;
	this.getPhotoSizes(this.imagesList[this.currentImage].id);
	this.deactivateNavButtons();
}

WelcomeWall.FlickrEventsHandler.prototype.getRandomPhotoForElement = function(element){ 
	console.log("getRandomPhotoForElement");
	var randomImageNumber = Math.floor((Math.random()*this.imagesList.length-1)+1);
	console.log(randomImageNumber);
	this.tempElement = element;
	this.getPhotoSizes(this.imagesList[randomImageNumber].id, this.getRandomPhotoForElementHandler);
	
}

WelcomeWall.FlickrEventsHandler.prototype.getRandomPhotoForElementHandler = function(data){
	console.log("getRandomPhotoForElementHandler");

	var bestSize = this.getBestPhotoSizeForArticle(data.sizes.size);
	var that = this;
	//console.log(data.sizes.size[data.sizes.size.length-1]);
	if(bestSize){
		console.log("Size Found");
		var newImage = $("<img />").attr({
			src : bestSize.source
		});
		this.tempElement.append(newImage);
		this.removeEventHandler("NO_SIZE_FOUND");
	}
	else {
		console.log("No Sizes Found");
		//this.broker.trigger("NO_SIZE_FOUND");
	}
}

WelcomeWall.Article.prototype.showFullArticle = function(){

}

WelcomeWall.FullArticle.prototype.showFullArticle = function(sourceNumber){
	console.log("Show Full Article");
	console.log(sourceNumber);
	var that = this;
	this.insertContent(sourceNumber);
	this.container.show();
	this.frontFaceTop.transition({
		rotateX: '-180deg',
		perspective: '1000px'
	}, 1000, function (){
		//that.broker.trigger("TILE_FLIP_COMPLETE", that.tileNumber);
		if(that.pdf === true){
			that.showPDF.call(that);
			that.frontFaceBottom.addClass("pdf");
		}
		else {
			that.setScrollNumbers();
		}
	});
}

WelcomeWall.FullArticle.prototype.insertContent = function(sourceNumber){
	console.log(sourceNumber);
	var source = articleSources[sourceNumber];
	if(source){
		var topImage = $("<div />").addClass("top-image");
		var topImage2 = $("<div />").addClass("top-image");
		var headLine = $("<h3 />").html(source.title);
		var content = $("<div />").html(source.feedbody);
		var headLine2 = $("<h3 />").html(source.title);
		var content2 = $("<div />").html(source.feedbody);
		this.topContentDiv = $("<div />").addClass("full-article-content-container").append(topImage).append(headLine).append(content);
		this.bottomContentDiv = $("<div />").addClass("full-article-content-container").append(topImage2).append(headLine2).append(content2);
		this.frontFaceBottom.append(this.topContentDiv);
		this.frontFaceBackFace.append(this.bottomContentDiv);
		WelcomeWall.flickrEventsHandler.getRandomPhotoForElement(topImage);
	}
	else {
		console.log("No Article Soure Found!");
		
		this.canvasElement = $("<canvas />").attr({
			id:"canvas-"+this.canvasId,
			height:"900"
		});
		this.canvasId++;
		this.topContentDiv = $("<div />").addClass("full-article-content-container-pdf").append(this.canvasElement);
		this.frontFaceBottom.append(this.topContentDiv);
		this.bottomContentDiv = $("<div />").addClass("full-article-content-container-pdf");
		this.frontFaceBackFace.append(this.bottomContentDiv);
		//this.frontFaceBottom.addClass("pdf");
		this.pdf = true;
		this.pdfDoc = null;
        this.pageNum = 1;
        this.pdfScale = 1.2;
        this.pdfCtx = document.getElementById(this.canvasElement.attr("id")).getContext('2d');
		//loadPDFDocument(canvasElement1.attr("id"));
		//loadPDFDocument(canvasElement2.attr("id"));

	}
}

WelcomeWall.FullArticle.prototype.showPDF = function(){
	
	console.log("Loading PDF");
	//loadPDFDocument(this.canvasElement.attr("id"), false, this.showPDFComplete, this);
	this.loadPDF();
	this.frontFaceTop.hide();
}

WelcomeWall.FullArticle.prototype.showPDFComplete = function() {
	//this.setScrollNumbers();

	this.canvasElement.addClass("shadowed");
}

WelcomeWall.FullArticle.prototype.setScrollNumbers = function() {
	this.scrollNumber = 0;
	this.scrollStop = this.topContentDiv.height() - ($("div[role='panel-2']").height()+50) + 100;
	console.log($("div[role='panel-2']"));
	console.log($(this.topContentDiv));
	console.log("Window Height: " + $("div[role='panel-2']").height());
	console.log("Article Height: " + $(this.topContentDiv).height());
	console.log("Starting Numbers");
	console.log(this.scrollNumber);
	console.log(this.scrollStop);
	this.articleHeight = this.topContentDiv.height();
	this.activateScrollButtons();
}

WelcomeWall.FullArticle.prototype.closeFullArticle = function (){
	console.log("Hide Full Article");
	var that = this;
	this.frontFaceTop.show();
	this.deactivateScrollButtons();
	if(this.pdf){
		this.topContentDiv.hide();
		this.frontFaceBottom.removeClass("pdf");
	}
	this.frontFaceTop.transition({
		rotateX: '0deg',
		perspective: '1000px'
	}, 1000, function (){
		if(that.pdf){
			that.pdf = false;
		}
		that.frontFaceBottom.html("");
		that.frontFaceBackFace.html("");
		that.container.hide();
	});
}

WelcomeWall.FullArticle.prototype.activatePDFButtons = function (){
	var that = this;
	this.articleCloseButton.unbind();
	this.scrollButtonTop.unbind();
	this.scrollButtonBottom.unbind();

	this.articleCloseButton.click(function (){
		that.closeFullArticle();
	});
	this.articleCloseButton.fadeIn();
	if(this.pageNum <= 1){
		this.scrollButtonTop.html("Previous Page").fadeOut();
		this.scrollButtonTop.unbind();
	}
	else{
		console.log("Showing Top Scroll Button");
		this.scrollButtonTop.fadeIn();
		this.scrollButtonTop.click(function(){
			that.getPreviousPDFPage();
		});
	}

	if(this.pageNum >= this.pdfDoc.numPages){
		this.scrollButtonBottom.fadeOut();
	}
	else {
		console.log("Showing Bottom Scroll Button");
		this.scrollButtonBottom.html("Next Page").fadeIn();
		this.scrollButtonBottom.click(function(){
			that.getNextPDFPage();
		});
	}
}

WelcomeWall.FullArticle.prototype.activateScrollButtons = function(){
	var that = this;
	//console.log(this.scrollStart);
	//console.log(this.scrollNumber);
	//console.log(this.articleHeight);
	this.articleCloseButton.unbind();
	this.scrollButtonTop.unbind();
	this.scrollButtonBottom.unbind();

	this.articleCloseButton.click(function (){
		that.closeFullArticle();
	});
	this.articleCloseButton.fadeIn();
	if(this.scrollNumber <= 0){
		this.scrollButtonTop.fadeOut();
		this.scrollButtonTop.unbind();
	}
	else{
		console.log("Showing Top Scroll Button");
		this.scrollButtonTop.html("Scroll Up").fadeIn();
		this.scrollButtonTop.click(function(){
			that.scrollArticleUp();
		});
	}

	if(this.scrollNumber >= this.scrollStop){
		this.scrollButtonBottom.fadeOut();
	}
	else {
		console.log("Showing Bottom Scroll Button");
		this.scrollButtonBottom.html("Scroll Down").fadeIn();
		this.scrollButtonBottom.click(function(){
			that.scrollArticleDown();
		});
	}
}

WelcomeWall.FullArticle.prototype.deactivateScrollButtons = function (){
	this.articleCloseButton.unbind();
	this.scrollButtonTop.unbind();
	this.scrollButtonBottom.unbind();
	this.articleCloseButton.fadeOut();
	this.scrollButtonTop.fadeOut();
	this.scrollButtonBottom.fadeOut();
}

WelcomeWall.FullArticle.prototype.scrollArticleDown = function(){
	//console.log(this.topContentDiv.height());
	//console.log(this.topContentDiv.offset().top);
	//console.log($(window).height());

	//var space = $(window).height() - (this.topContentDiv.offset().top + this.topContentDiv.height());
	//console.log(space);
	var scrollAmount = 400;
	if(this.topContentDiv){
		this.topContentDiv.animate({top: "-="+scrollAmount});
	}
	if(this.bottomContentDiv){
		this.bottomContentDiv.animate({top: "-="+scrollAmount});
	}
	
	
	this.scrollNumber +=scrollAmount;
	this.activateScrollButtons();
}

WelcomeWall.FullArticle.prototype.scrollArticleUp = function(){
	//console.log(this.topContentDiv.height());
	//console.log(this.topContentDiv.offset().top);
	//console.log($(window).height());



	///var space = $(window).height() - (this.topContentDiv.offset().top + this.topContentDiv.height());
	//console.log(space);
	var scrollAmount = 400;
	if(this.topContentDiv){
		this.topContentDiv.animate({top: "+="+scrollAmount});
	}
	if(this.bottomContentDiv){
		this.bottomContentDiv.animate({top: "+="+scrollAmount});
	}
	
	
	this.scrollNumber -=scrollAmount;
	this.activateScrollButtons();
}

WelcomeWall.FullArticle.prototype.loadPDF = function(url, callBack){
	console.log("Loadng PDF...");
	var that = this;
	this.pdfURL = url || 'assets/pdf/CaseStudy_MikeWard.pdf';
	console.log(this.pdfURL);
	PDFJS.disableWorker = true;

	PDFJS.getDocument(this.pdfURL).then(function getPdfHelloWorld(_pdfDoc) {
      that.pdfDoc = _pdfDoc;
      	that.showPDFComplete.call(that);
      
      that.renderPDFPage(that.pageNum);
    });
}

WelcomeWall.FullArticle.prototype.renderPDFPage = function(num){
	// Using promise to fetch the page
	console.log("Rendering PDF Page: " + num);
	var that = this;
	console.log(this.pdfDoc);
      this.pdfDoc.getPage(num).then(function(page) {
      	console.log(page);
        var viewport = page.getViewport(that.pdfScale);
        var canvas = document.getElementById(that.canvasElement.attr("id"));
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        that.topContentDiv.width(canvas.width + "px");
        that.topContentDiv.height(canvas.height + "px");

        console.log(that.pdfCtx);
        console.log(that.canvasElement.attr("id"));

        // Render PDF page into canvas context
        var renderContext = {
          canvasContext: canvas.getContext('2d'),
          viewport: viewport
        };
        page.render(renderContext);

		that.activatePDFButtons();
      });

      // Update page counters
      //document.getElementById('page_num').textContent = pageNum;
      //document.getElementById('page_count').textContent = pdfDoc.numPages;
}

WelcomeWall.FullArticle.prototype.getNextPDFPage = function(){
	if (this.pageNum >= this.pdfDoc.numPages)
        return;
      this.pageNum++;
      this.renderPDFPage(this.pageNum);
}

WelcomeWall.FullArticle.prototype.getPreviousPDFPage = function(){
	if (this.pageNum <= 1)
        return;
      this.pageNum--;
      this.renderPDFPage(this.pageNum);
}

WelcomeWall.TileGroup.prototype.flipTile = function (tileNumber){
	console.log("Flipping Tile: " + tileNumber);
	this.bringTileToFront(tileNumber);
	this.currentTile = tileNumber;
	//console.log(this.tiles[tileNumber].backFace.offset().top);
	//var topPos = this.tiles[tileNumber].backFace.offset().top + 330;
	//var leftPos = this.tiles[tileNumber].backFace.offset().left - 30;
	//this.tileReadMoreButton.css({"top":topPos, "left":leftPos}).show();
	//his.tileCloseButton.css({"top":topPos, "left":(leftPos + 100)}).show();
	
	
}

WelcomeWall.TileGroup.prototype.activateArticleNavButtons = function (){
	this.tileReadMoreButton.fadeIn();
	this.tileCloseButton.fadeIn();
	this.tileCloseButton.click(bindContext(this.closeButtonClickHandler, this, this.currentTile));
	this.tileReadMoreButton.click(bindContext(this.moreButtonClickHandler, this, this.currentTile));
}

WelcomeWall.TileGroup.prototype.deactivateArticleNavButtons = function (){
	this.tileReadMoreButton.hide();
	this.tileCloseButton.hide();
	this.tileCloseButton.unbind();
	this.tileReadMoreButton.unbind();
}

WelcomeWall.TileGroup.prototype.activateNavButtons = function (){
	console.log(this.nextButton);
	this.nextButton.fadeIn();
	this.previousButton.fadeIn();
	this.nextButton.click(bindContext(this.nextButtonClickHandler, this, this.currentTile));
	this.previousButton.click(bindContext(this.previousButtonClickHandler, this, this.currentTile));
}

WelcomeWall.TileGroup.prototype.deactivateNavButtons = function (){
	this.nextButton.hide();
	this.previousButton.hide();
	this.unBindNavButtons();
}

WelcomeWall.TileGroup.prototype.unBindNavButtons = function () {
	this.nextButton.unbind()
	this.previousButton.unbind();
}

WelcomeWall.TileGroup.prototype.resetCurrentTile = function(tileNumber){
	console.log("Resetting Tile: " + tileNumber);
	
	this.tiles[this.currentTile].reset();

}

WelcomeWall.TileGroup.prototype.bringTileToFront = function(tileNumber){
	this.tiles[tileNumber].container.css({"z-index":"200"});
}

WelcomeWall.TileGroup.prototype.sendTileToBack = function(tileNumber){
	console.log(tileNumber);
	this.tiles[tileNumber].container.css({"z-index":""});
}


WelcomeWall.TileGroup.prototype.nextButtonClickHandler = function (){
	this.unBindNavButtons();
	this.deactivateArticleNavButtons();
	this.groupEvents.on("TILE_RESET:NAV", bindContext(this.goToNextTile, this));
	this.resetCurrentTile();
}

WelcomeWall.TileGroup.prototype.previousButtonClickHandler = function (){
	this.unBindNavButtons();
	this.deactivateArticleNavButtons();
	this.groupEvents.on("TILE_RESET:NAV", bindContext(this.goToPreviousTile, this));
	this.resetCurrentTile();
}

WelcomeWall.TileGroup.prototype.closeButtonClickHandler = function(){
	this.deactivateArticleNavButtons();
	this.deactivateNavButtons();
	this.resetCurrentTile();
}

WelcomeWall.TileGroup.prototype.moreButtonClickHandler = function(){

	this.deactivateArticleNavButtons();
	this.deactivateNavButtons();
	this.groupEvents.on("TILE_RESET:NAV", bindContext(this.moreButtonEventHandler, this, [this.sourceNumber]));
	this.resetCurrentTile();
}

WelcomeWall.TileGroup.prototype.moreButtonEventHandler = function(info){
	//console.log("More Event");
	this.groupEvents.off("TILE_RESET:NAV");
	//console.log(info);
	this.broker.trigger("MORE_BUTTON_CLICKED", info);
}

WelcomeWall.TileGroup.prototype.goToNextTile = function (){
	this.groupEvents.off("TILE_RESET:NAV");
	var currentTileNumber = parseInt(this.currentTile);
	var nextTile;
	if(currentTileNumber == 4){
		nextTile = 1;
	}
	else {
		nextTile = currentTileNumber +1;
	}
	this.flipTile(nextTile)
	this.tiles[nextTile].flip();
}

WelcomeWall.TileGroup.prototype.goToPreviousTile = function (){
	this.groupEvents.off("TILE_RESET:NAV");
	var currentTileNumber = parseInt(this.currentTile);
	var nextTile;
	if(currentTileNumber == 1){
		nextTile = 4;
	}
	else {
		nextTile  = currentTileNumber -1;;
	}
	this.flipTile(nextTile)
	this.tiles[nextTile].flip();
}

WelcomeWall.Tile.prototype.clickHandler = function (){
	this.broker.trigger("TILE_CLICKED", this.tileNumber);
	this.flip();
}

WelcomeWall.Tile.prototype.flip = function (){
	var that = this;
	this.element.transition({
		rotateX: '180deg',
		perspective: '1000px'
	}, function (){
		that.broker.trigger("TILE_FLIP_COMPLETE", that.tileNumber);
	});
}

WelcomeWall.Tile.prototype.reset = function (){
	var that = this;
	this.element.transition({
		rotateX: '0deg',
		perspective: '1000px'
	}, function (){
		that.broker.trigger("TILE_RESET", that.tileNumber);
		that.broker.trigger("TILE_RESET:NAV", that.tileNumber);
	});
}



function loadPDFDocument(canvasId, url, callBack, callBackContext){
	//
    // NOTE:
    // Modifying the URL below to another server will likely *NOT* work. Because of browser
    // security restrictions, we have to use a file server with special headers
    // (CORS) - most servers don't support cross-origin browser requests.
    //
    var url = url || 'assets/pdf/CaseStudy_MikeWard.pdf';

    //
    // Disable workers to avoid yet another cross-origin issue (workers need the URL of
    // the script to be loaded, and dynamically loading a cross-origin script does
    // not work)
    //
    PDFJS.disableWorker = true;

    //
    // Asynchronous download PDF as an ArrayBuffer
    //
    PDFJS.getDocument(url).then(function getPdfHelloWorld(pdf) {
      //
      // Fetch the first page
      //
      pdf.getPage(1).then(function getPageHelloWorld(page) {
        var scale = 1.5;
        var viewport = page.getViewport(scale);

        //
        // Prepare canvas using PDF page dimensions
        //
        var canvas = document.getElementById(canvasId);
        var context = canvas.getContext('2d');
        //canvas.height = viewport.height;
        canvas.width = viewport.width;

        //
        // Render PDF page into canvas context
        //
        page.render({canvasContext: context, viewport: viewport});
        callBack.call(callBackContext);
      });
    });
}



function bindGlassPanel(element){
	$(element).children(".panel-container").children(".panel.front").children(".open-button").click(function (){
		$(this).unbind();
		//$(element).children(".panel-container").children(".panel.front").children(".open-button").hide();
		//$(element).children(".panel-container").children(".panel.front").children(".agenda-button").hide();
		$(element).transition({
				rotateX: '180deg',
				perspective: '500px'
			}, function (){
				$(this).children(".panel-container").children(".panel.back").children(".hide-button").click(function(){
					$(element).transition({
						rotateX: '0deg',
						perspective: '500px'}, function (){
							bindGlassPanel(element);
					});
					$(this).unbind();
				});
			});
	});
}

function parseRSS(url, callback) {
	  $.ajax({
	    url: document.location.protocol + '//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&callback=?&q=' + encodeURIComponent(url),
	    dataType: 'json',
	    success: function(data) {
	      callback(data.responseData.feed);
	    }
	  });
}



function displayFlickrFeed(data){
	console.log("Displaying flickr Feed");
	console.log(data);
}

function displayPhotoSizes (photo){
	console.log("Getting Photo sizes");
	var photoId = photo.id;
	$.getJSON("http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&photo_id=" + photoId + "&api_key=3bdd28c7cb805fc97e345cfc6f4bf0b3&format=json&=?");
}

function flipTile(element){
	

	$(element).transition({
		rotateX: '180deg',
		perspective: '1000px'
	}, function (){
	//console.log($(element).children("face.back").children("tilefacecontent").offset());
	//console.log($(element).children("face.back").children("tilefacecontent").width());
	//console.log($(element).children("face.back").children("tilefacecontent").height());
	activateTileNavButtons(myArticleNumber);

	var topPos = ($(element).children("face.back").children("tilefacecontent").offset().top + $(element).children("face.back").children("tilefacecontent").height()) - 20;
	var leftPos = ($(element).children("face.back").children("tilefacecontent").offset().left + $(element).children("face.back").children("tilefacecontent").width()) - 560;
	var readMoreButton = $(".article-button.readmore[article="+myArticleNumber+"]");
	var closeButton = $(".article-button.close[article="+myArticleNumber+"]");

	readMoreButton.offset({top:topPos, left: leftPos});
	readMoreButton.fadeIn();
		//Remove all click events from tiles
		console.log("yo");
		console.log($("articlecontainer[article="+myArticleNumber+"] tile"));
		$("articlecontainer[article="+myArticleNumber+"] tile").unbind();

		readMoreButton.click(function(){
			$(".article-button.readmore[article="+myArticleNumber+"]").hide();
			$(".article-button.close[article="+myArticleNumber+"]").hide();
			
			//On click, flip the tile over again
			$(element).transition({
				rotateX: '0deg',
				perspective: '100px'
			}, function (){
				$("articlecontainer[article="+myArticleNumber+"] tile").css({"-webkit-transform-style": "flat"});
				console.log($(element).attr("articleSource"));
				$("articlecontainer[article="+myArticleNumber+"] articleface.back iframe").attr("src", $(element).attr("articleSource"));
				flipArticle($(element).attr("article"));
			});
			
			
		});

		closeButton.offset({top:topPos, left: leftPos+90});
		closeButton.fadeIn();

		closeButton.click(function (){
			
			resetTile(element, myArticleNumber);
			deactivateTileNavButtons(myArticleNumber);
		});
	});

	
}

function resetTile(element, articleNumber){
	console.log("Resetting Tile");
	console.log($(element));
	if($(element).hasClass("flipped")){
		$(element).removeClass("flipped");
	}
	else {
		
	}

	$(".article-button.readmore[article="+articleNumber+"]").offset({top:0, left: 0});
	$(".article-button.readmore[article="+articleNumber+"]").hide();
	$(".article-button.readmore[article="+articleNumber+"]").unbind();


	$(".article-button.close[article="+articleNumber+"]").offset({top:0, left: 0});
	$(".article-button.close[article="+articleNumber+"]").hide();
	$(".article-button.close[article="+articleNumber+"]").unbind();

	

	$(element).transition({
		rotateX: '0deg',
		perspective: '100px'
	}, function (){
		$(element).parent("tilecontainer").css({"z-index":""});
		bindTiles(articleNumber);
	});
}


function flipArticle(articleNumber){
	console.log("Showing article: " + articleNumber);
	$("articlecontainer[article="+articleNumber+"] tile").removeClass("flipped");

	$("articlecontainer[article="+articleNumber+"]").show();
	$("articlecontainer[article="+articleNumber+"]").transition({
		rotateY: '180deg',
		perspective: '1000px'
	}, 500,  function(){
		var topPos = $(this).height() - 500;
		var leftPos = $(this).width();
		$(".article-button.close[article="+articleNumber+"]").offset({top: topPos, left: leftPos});
		$(".article-button.close[article="+articleNumber+"]").fadeIn();
		$(".article-button.close[article="+articleNumber+"]").unbind();
		$(".article-button.close[article="+articleNumber+"]").click(function (){
			resetArticle(articleNumber);
		});
		
	});
}

function resetArticle(articleNumber){
	$(".article-button.close").hide();
	$(".article-button.close").unbind();
	$("articlecontainer[article="+articleNumber+"]").transition({
		rotateY: '0deg',
		perspective: '1000px'
	}, 500,  function(){
		$("articlecontainer[article="+articleNumber+"] tilecontainer").css({"z-index":""});
		bindTiles(articleNumber);
		
	});
}

function bindTiles(articleNumber){
	$("articlecontainer[article="+articleNumber+"] tile").css({"-webkit-transform-style": "preserve-3d"}); 
	$("articlecontainer[article="+articleNumber+"] tile").click(function (){
			flipTile($(this));
	});
}

function activateTileNavButtons(articleNumber){
	$(".tile-nav-button.next[article="+articleNumber+"]").fadeIn();
	$(".tile-nav-button.next[article="+articleNumber+"]").unbind();
	$(".tile-nav-button.next[article="+articleNumber+"]").click(function(){
		goToNextTile(articleNumber);
	});

	$(".tile-nav-button.previous[article="+articleNumber+"]").fadeIn();
	$(".tile-nav-button.previous[article="+articleNumber+"]").unbind();
	$(".tile-nav-button.previous[article="+articleNumber+"]").click(function(){
		goToPreviousTile(articleNumber);
	});
}

function deactivateTileNavButtons(articleNumber){
	$(".tile-nav-button.next[article="+articleNumber+"]").fadeOut();
	$(".tile-nav-button.next[article="+articleNumber+"]").unbind();

	$(".tile-nav-button.previous[article="+articleNumber+"]").fadeOut();
	$(".tile-nav-button.previous[article="+articleNumber+"]").unbind();
}

function goToNextTile(articleNumber){
	console.log(articleNumber);
	var currentTileNumber = $("articlecontainer[article="+articleNumber+"] tilegroupcontainer tilegroup").attr("currentTile");
	var currentTile = $("articlecontainer[article="+articleNumber+"] tilecontainer[tile="+currentTileNumber+"] tile");
	console.log(currentTileNumber);
	console.log(currentTile);
	
	currentTileNumber = parseInt(currentTileNumber);
	
	var nextTile;
	if(currentTileNumber == 4){
		nextTile = $("articlecontainer[article="+articleNumber+"] tilecontainer[tile="+1+"] tile");
	}
	else {
		currentTileNumber = currentTileNumber +1;
		nextTile = $("articlecontainer[article="+articleNumber+"] tilecontainer[tile="+currentTileNumber+"] tile");
	}

	flipTile(nextTile);
	resetTile(currentTile, articleNumber);
}

function goToPreviousTile(articleNumber){
	console.log(articleNumber);
	var currentTileNumber = $("articlecontainer[article="+articleNumber+"] tilegroupcontainer tilegroup").attr("currentTile");
	var currentTile = $("articlecontainer[article="+articleNumber+"] tilecontainer[tile="+currentTileNumber+"] tile");
	console.log(currentTileNumber);
	console.log(currentTile);
	
	currentTileNumber = parseInt(currentTileNumber);
	
	var nextTile;
	if(currentTileNumber == 1){
		nextTile = $("articlecontainer[article="+articleNumber+"] tilecontainer[tile="+4+"] tile");
	}
	else {
		currentTileNumber = currentTileNumber -1;
		nextTile = $("articlecontainer[article="+articleNumber+"] tilecontainer[tile="+currentTileNumber+"] tile");
	}

	flipTile(nextTile);
	resetTile(currentTile, articleNumber);
}
